/*
KEEP

Acid Attack	6	Keep	Deal 1 extra damage each turn (even when you don't otherwise attack).
Alien Metabolism	3	Keep	Buying cards costs you 1 less [Energy].
Alpha Monster	5	Keep	Gain 1[Star] when you attack.
Armor Plating	4	Keep	Ignore damage of 1.
Background Dweller	4	Keep	You can always reroll any [3] you have.
Burrowing	5	Keep	Deal 1 extra damage on Tokyo. Deal 1 damage when yielding Tokyo to the monster taking it.
Camouflage	3	Keep	If you take damage roll a die for each damage point. On a [Heart] you do not take that damage point.
Complete Destruction	3	Keep	If you roll [1][2][3][Heart][Attack][Energy] gain 9[Star] in addition to the regular results.
Dedicated News Team	3	Keep	Gain 1[Star] whenever you buy a card.
Eater of the Dead	4	Keep	Gain 3[Star] every time a monster's [Heart] goes to 0.
Energy Hoarder	3	Keep	You gain 1[Star] for every 6[Energy] you have at the end of your turn.
Even Bigger	4	Keep	Your maximum [Heart] is increased by 2. Gain 2[Heart] when you get this card.
Extra Head (x2)	7	Keep	You get 1 extra die.
Fire Breathing	4	Keep	Your neighbors take 1 extra damage when you deal damage
Freeze Time	5	Keep	On a turn where you score [1][1][1], you can take another turn with one less die.
Friend of Children	3	Keep	When you gain any [Energy] gain 1 extra [Energy].
Giant Brain	5	Keep	You have one extra reroll each turn.
Gourmet	4	Keep	When scoring [1][1][1] gain 2 extra [Star].
Healing Ray	4	Keep	You can heal other monsters with your [Heart] results. They must pay you 2[Energy] for each damage you heal (or their remaining [Energy] if they haven't got enough.
Herbivore	5	Keep	Gain 1[Star] on your turn if you don't damage anyone.
Herd Culler	3	Keep	You can change one of your dice to a [1] each turn.
It Has a Child	7	Keep	If you are eliminated discard all your cards and lose all your [Star], Heal to 10[Heart] and start again.
Jets	5	Keep	You suffer no damage when yielding Tokyo.
Made in a Lab	2	Keep	When purchasing cards you can peek at and purchase the top card of the deck.
Metamorph	3	Keep	At the end of your turn you can discard any keep cards you have to receive the [Energy] they were purchased for.
Mimic	8	Keep	Choose a card any monster has in play and put a mimic counter on it. This card counts as a duplicate of that card as if it just had been bought. Spend 1[Energy] at the start of your turn to change the power you are mimicking.
Monster Batteries	2	Keep	When you purchase this put as many [Energy] as you want on it from your reserve. Match this from the bank. At the start of each turn take 2[Energy] off and add them to your reserve. When there are no [Energy] left discard this card.
Nova Breath	7	Keep	Your attacks damage all other monsters.
Omnivore	4	Keep	Once each turn you can score [1][2][3] for 2[Star]. You can use these dice in other combinations.
Opportunist	3	Keep	Whenever a new card is revealed you have the option of purchasing it as soon as it is revealed.
Parasitic Tentacles	4	Keep	You can purchase cards from other monsters. Pay them the [Energy] cost.
Plot Twist	3	Keep	Change one die to any result. Discard when used.
Poison Quills	3	Keep	When you score [2][2][2] also deal 2 damage.
Poison Spit	4	Keep	When you deal damage to monsters give them a poison counter. Monsters take 1 damage for each poison counter they have at the end of their turn. You can get rid of a poison counter with a [Heart] (that [Heart] doesn't heal a damage also).
Psychic Probe	3	Keep	You can reroll a die of each other monster once each turn. If the reroll is [Heart] discard this card.
Rapid Healing	3	Keep	Spend 2[Energy] at any time to heal 1 damage.
Regeneration	4	Keep	When you heal, heal 1 extra damage.
Rooting for the Underdog	3	Keep	At the end of a turn when you have the fewest [Star] gain 1 [Star].
Shrink Ray	6	Keep	When you deal damage to monsters give them a shrink counter. A monster rolls one less die for each shrink counter. You can get rid of a shrink counter with a [Heart] (that [Heart] doesn't heal a damage also).
Smoke Cloud	4	Keep	This card starts with 3 charges. Spend a charge for an extra reroll. Discard this card when all charges are spent.
Solar Powered	2	Keep	At the end of your turn gain 1[Energy] if you have no [Energy].
Spiked Tail	5	Keep	When you attack deal 1 extra damage.
Stretchy	3	Keep	You can spend 2[Energy] to change one of your dice to any result.
Telepath	4	Keep	Spend 1[Energy] to get 1 extra reroll.
Urbavore	4	Keep	Gain 1 extra [Star] when beginning the turn in Tokyo. Deal 1 extra damage when dealing any damage from Tokyo.
We're Only Making It Stronger	3	Keep	When you lose 2[Heart] or more gain 1[Energy].
Wings	6	Keep	Spend 2[Energy] to negate damage to you for a turn.
Cannibalistic	5	Keep	When you do damage gain 1[Heart].
Intimidating Roar	3	Keep	The monsters in Tokyo must yield if you damage them.
Monster Sidekick	4	Keep	If someone kills you, Go back to 10[Heart] and lose all your [Star]. If either of you or your killer win, or all other players are eliminated then you both win. If your killer is eliminated then you are also. If you are eliminated a second time this card has no effect.
Reflective Hide	6	Keep	If you suffer damage the monster that inflicted the damage suffers 1 as well.
Sleep Walker	3	Keep	Spend 3[Energy] to gain 1[Star].
Super Jump	4	Keep	Once each turn you may spend 1[Energy] to negate 1 damage you are receiving.
Throw a Tanker	4	Keep	On a turn you deal 3 or more damage gain 2[Star].
Thunder Stomp	3	Keep	If you score 4[Star] in a turn, all players roll one less die until your next turn.
Unstable DNA	3	Keep	If you yield Tokyo you can take any card the recipient has and give him this card.

DISCARD

Apartment Building	5	Discard	"+ 3[Star]"
Commuter Train	4	Discard	"+ 2[Star]"
Corner Store	3	Discard	"+ 1[Star]"
Drop from High Altitude	5	Discard	"+ 2[Star] and take control of Tokyo if you don't already control it."
Energize	8	Discard	"+ 9[Energy]"
Evacuation Orders (x2)	7	Discard	All other monsters lose 5[Star].
Fire Blast	3	Discard	Deal 2 damage to all other monsters.
Frenzy	7	Discard	When you purchase this card Take another turn immediately after this one.
Gas Refinery	6	Discard	"+ 2[Star] and deal 3 damage to all other monsters."
Heal	3	Discard	Heal 2 damage.
High Altitude Bombing	4	Discard	All monsters (including you) take 3 damage.
Jet Fighters	5	Discard	"+ 5[Star] and take 4 damage"
National Guard	3	Discard	"+ 2[Star] and take 2 damage."
Nuclear Power Plant	6	Discard	"+ 2[Star] and heal 3 damage."
Skyscraper	6	Discard	"+ 4[Star]"
Tanks	4	Discard	"+ 4[Star] and take 3 damage."
Vast Storm	6	Discard	"+ 2[Star]. All other monsters lose 1[Energy] for every 2[Energy] they have."
Amusement Park	6	Discard	"+ 4[Star]"
Army	2	Discard	(+ 1[Star] and suffer one damage) for each card you have.
*/

class Cards {
    constructor (private game: KingOfTokyoGame) {}
    
    public setupCards(stocks: Stock[]) {

        stocks.forEach(stock => {
            const keepcardsurl = `${g_gamethemeurl}img/cards0.jpg`;
            for(let id=1; id<=48; id++) {  // keep
                stock.addItemType(id, id, keepcardsurl, id);
            }

            const discardcardsurl = `${g_gamethemeurl}img/cards1.jpg`;
            for(let id=101; id<=118; id++) {  // discard
                stock.addItemType(id, id, discardcardsurl, id);
            }
        });
    }
    
    public getCardUniqueId(color: number, value: number) {
        return color * 100 + value;
    }
    
    public getCardWeight(color: number, value: number) {
        let displayedNumber = value;
        if (displayedNumber === 70 || displayedNumber === 90) {
            displayedNumber /= 10;
        }
        return displayedNumber * 100 + color;
    }

    private getDiscardName(cardTypeId: number) {
        switch( cardTypeId ) {
            case 101: return _("Apartment Building");
            case 102: return _("Commuter Train");
            case 103: return _("Corner Store");
            case 104: return _("Drop From High Altitude");
            case 105: return _("Energize");
            case 106: case 107: return _("Evacuation Orders");
            case 108: return _("Fire Blast");
            case 109: return _("Frenzy");
            case 110: return _("Gas Refinery");
            case 111: return _("Heal");
            case 112: return _("High Altitude Bombing");
            case 113: return _("Jet Fighters");
            case 114: return _("National Guard");
            case 115: return _("Nuclear Power Plant");
            case 116: return _("Skyscraper");
            case 117: return _("Tanks");
            case 118: return _("Vast Storm");
            case 119: return _("Amusement Park");
            case 120: return _("Army");
        }
        return null;


    }

    private getDiscardDescription(cardTypeId: number) {
            switch( cardTypeId ) {
            case 101: return _("+ 3[Star]");
            case 102: return _("+ 2[Star]");
            case 103: return _("+ 1[Star]");
            case 104: return _("+ 2[Star] and take control of Tokyo if you don't already control it.");
            case 105: return _("+ 9[Energy]");
            case 106: case 107: return _("All other monsters lose 5[Star].");
            case 108: return _("Deal 2 damage to all other monsters.");
            case 109: return _("When you purchase this card Take another turn immediately after this one."); // TODO check spelling
            case 110: return _("+ 2[Star] and deal 3 damage to all other monsters.");
            case 111: return _("Heal 2 damage.");
            case 112: return _("All monsters (including you) take 3 damage.");
            case 113: return _("+ 5[Star] and take 4 damage");
            case 114: return _("+ 2[Star] and take 2 damage.");
            case 115: return _("+ 2[Star] and heal 3 damage.");
            case 116: return _("+ 4[Star]");
            case 117: return _("+ 4[Star] and take 3 damage.");
            case 118: return _("+ 2[Star]. All other monsters lose 1[Energy] for every 2[Energy] they have.");
            case 119: return _("+ 4[Star]");
            case 120: return _("(+ 1[Star] and suffer one damage) for each card you have."); // TODO check spelling
        }
        return null;
    }

    private formatDescription(rawDescription: string) {
        return rawDescription
            .replace(/\[Star\]/ig, '<span class="icon health"></span>')
            .replace(/\[Energy\]/ig, '<span class="icon energy"></span>');
    }

    private getTooltip(cardTypeId: number) {
        let tooltip = `<div class="card-tooltip">
            <p><strong>${this.getDiscardName(cardTypeId)}</strong></p>
            <p>${this.formatDescription(this.getDiscardDescription(cardTypeId))}</p>
        </div>`;
        return tooltip;
    }

    public setupNewCard(card_div: HTMLDivElement, card_type_id: number) {
        const type = card_type_id < 100 ? _('Keep') : _('Discard');
        const name = this.getDiscardName(card_type_id);
        const description = this.formatDescription(this.getDiscardDescription(card_type_id));
        card_div.innerHTML = `
        <div class="name-wrapper">
            <div class="outline">${name}</div>
            <div class="text">${name}</div>
        </div>
        <div class="type-wrapper ${ card_type_id < 100 ? 'keep' : 'discard'}">
            <div class="outline">${type}</div>
            <div class="text">${type}</div>
        </div>
        <div class="description-wrapper"><div>${description}</div></div>
        `;
        
        (this.game as any).addTooltipHtml( card_div.id, this.getTooltip(card_type_id));
    }
}